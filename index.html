<html>
<title>
   duncap directory
</title>
<link rel="shortcut icon" type="image/jpg" href="https://raw.githubusercontent.com/duncap/duncap.github.io/main/icon.ico"/>
<style>
@font-face {
  font-family: win95bold;
  src: url(https://duncap.github.io/MSBold.ttf);
}

@font-face {
  font-family: win95;
  src: url(https://duncap.github.io/MS.ttf);
}
	
:root {
	--blue-gradient: linear-gradient(to bottom, #245edb 0%, #3f8cf3 9%, #245edb 18%, #245edb 92%, #333 100%) center/cover no-repeat;
        --lighter-blue: #08216b;
        --even-lighter-blue: #silver;
        --lightest-blue: #silver;
        --logo-blue: black;
        --light-orange: #08216b;
        --dark-orange: black;
        --blood-orange: black;
}

body {
   background-color: #007e7e;
}

inner {
   border: 2px solid var(--lighter-blue);
}

button {
    border-width: 2px;
    border-style: outset;
    border-color: buttonface;
    border-right-color: #424242;
    border-bottom-color: #424242;
    background: silver;
    font-family: win95;
    color: black;
    padding: 4px;
    border-radius: 1px;
    margin-left: 20px;
    margin-bottom: 20px;
}

select {
    border-width: 2px;  /* Ensure the border thickness is 2px */
    border-style: outset;
    border-color: buttonface;
    border-right-color: #424242;
    border-bottom-color: #424242;
    background: silver;
    font-family: win95;
    color: black;
    padding: 4px;
    border-radius: 1px;  /* Match the border-radius with the button */
    margin-left: 20px;
    margin-bottom: 20px;
}

nav {
    font-family: win95;
    border: solid;
    border-width: 2px;
    border-bottom-color: #424242;
    border-right-color: #424242;
    border-left-color: #fff;
    border-top-color: #fff;
}

nav .top {
   background: #08216b;
}

nav .links {
   background: silver;
}

nav .links a {
   text-shadow: 0 0 7px silver;
   color: black;
}

h1 {
  font-family: win95bold;
}

h2 {
  font-family: win95bold;
  margin: 20px;
}

h3 {
  font-family: win95bold;
}

h4 {
  font-family: win95bold;
  color: white;
}

.blog-preview h4 {
   color: black;
}

p {
  font-family: win95;
  margin: 20px;
}

footer {
   background: silver;
   font-family: win95;
   border: solid;
   border-width: 2px;
   border-bottom-color: #424242;
   border-right-color: #424242;
   border-left-color: #fff;
   border-top-color: #fff;
}

main {
   margin: 50px;
   background: silver;
   font-family: win95;
   border: solid;
   border-width: 2px;
   border-bottom-color: #424242;
   border-right-color: #424242;
   border-left-color: #fff;
   border-top-color: #fff;
}
</style>
<script>
let files = [
    { name: "legal agreement by duncap", path: "legalagreement" },
    { name: "gyatt by bawls", path: "page/gyatt" },
    { name: "shrek by sebastian", path: "page/shrek" }
];

async function fetchCommitData() {
    return Promise.all(files.map(file => 
        Promise.all([
            fetch(`https://api.github.com/repos/duncap/duncap.github.io/commits?path=${file.path}&per_page=1`)
                .then(response => response.json())
                .then(commits => {
                    if (commits.length > 0) {
                        return { ...file, latestCommit: new Date(commits[0].commit.committer.date) };
                    }
                    return { ...file };
                }),
            fetch(`https://api.github.com/repos/duncap/duncap.github.io/commits?path=${file.path}&per_page=1&page=1`)
                .then(response => response.json())
                .then(commits => {
                    if (commits.length > 0) {
                        return { ...file, firstCommit: new Date(commits[commits.length - 1].commit.committer.date) };
                    }
                    return { ...file };
                })
        ]).then(([latest, first]) => ({ ...latest, ...first }))
    ));
}

function updateButtons(newFiles) {
    const container = document.getElementById("buttonsContainer");

    // Check if there is any change
    if (JSON.stringify(files) !== JSON.stringify(newFiles)) {
        files = newFiles;
        sortAndDisplayButtons();
    }
}

async function sortAndDisplayButtons() {
    // Get sort value
    const sortValue = document.getElementById('sortSelect').value;

    // Sort files based on selected sort value
    if (sortValue === 'latest') {
        files.sort((a, b) => b.latestCommit - a.latestCommit);
    } else if (sortValue === 'oldest') {
        files.sort((a, b) => a.firstCommit - b.firstCommit);
    }

    // Update buttons smoothly without clearing
    const container = document.getElementById("buttonsContainer");
    const existingButtons = Array.from(container.querySelectorAll('a'));
    const updatedButtons = files.map(file => {
        const buttonHTML = `<a href="https://duncap.github.io/${file.path}"><button>${file.name}</button></a>`;
        return buttonHTML;
    });

    // Update or add buttons
    updatedButtons.forEach((buttonHTML, index) => {
        if (existingButtons[index] && existingButtons[index].outerHTML !== buttonHTML) {
            existingButtons[index].outerHTML = buttonHTML;
        } else if (!existingButtons[index]) {
            container.insertAdjacentHTML('beforeend', buttonHTML);
        }
    });

    // Remove extra buttons if any
    while (existingButtons.length > files.length) {
        container.removeChild(container.lastChild);
    }
}

// Initial fetch and display
fetchCommitData().then(updateButtons);

// Periodic check every 3 seconds
setInterval(() => {
    fetchCommitData().then(updateButtons);
}, 3000);

// Run the function when the window loads
window.onload = sortAndDisplayButtons;
</script>
</head>
<body>
    <main>
        <h2>duncap directory m8</h2>
        <p>user-generated pages or some shit (always updating).</p>
        <a href="https://duncap.github.io/submit"><p>submit your page here</p></a>
        <select id="sortSelect" onchange="sortAndDisplayButtons()">
            <option value="latest">latest updated</option>
            <option value="oldest">oldest</option>
        </select>
        <div id="buttonsContainer"></div>
    </main>
</body>
</html>
